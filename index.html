<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</title>

<style>
:root {
  --main: #1e88e5;
  --bg: #f2f4f8;
}

body {
  margin: 0;
  font-family: Tahoma, Arial, sans-serif;
  background: var(--bg);
}

.container {
  max-width: 600px;
  margin: auto;
  padding: 16px;
}

h1 {
  text-align: center;
  color: var(--main);
  font-size: 24px;
}

input {
  width: 100%;
  padding: 14px;
  font-size: 18px;
  border-radius: 10px;
  border: 1px solid #ccc;
  margin-top: 12px;
}

.card {
  background: #fff;
  margin-top: 18px;
  padding: 20px;
  border-radius: 14px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

.card h2 {
  margin: 0 0 14px;
  font-size: 22px;
}

.info {
  font-size: 19px;
  margin-bottom: 10px;
}

.label {
  color: #555;
}

.code {
  font-size: 28px;
  font-weight: bold;
  color: var(--main);
  text-align: center;
  margin-top: 16px;
}

.notfound {
  background: #fff3cd;
  padding: 14px;
  margin-top: 18px;
  border-radius: 10px;
  font-size: 18px;
  text-align: center;
}

@media (max-width: 480px) {
  h1 { font-size: 22px; }
  .card h2 { font-size: 20px; }
  .info { font-size: 18px; }
  .code { font-size: 24px; }
}
</style>
</head>

<body>

<div class="container">
  <h1>ğŸ” Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ù…Ø¯Ø±Ø³Ø© Ø§Ø¯ÙƒÙˆ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠÙ‡ Ø¨Ù†ÙŠÙ† </h1>
  <input id="search" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
  <div id="results"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
Â  apiKey: "AIzaSyBtRexl58EMIFgOF_IGaA_i9qn9kyw0hpQ",
Â  authDomain: "thanwia-banin.firebaseapp.com",
Â  databaseURL: "https://thanwia-banin-default-rtdb.firebaseio.com",
Â  projectId: "thanwia-banin",
Â  storageBucket: "thanwia-banin.firebasestorage.app",
Â  messagingSenderId: "264407319824",
Â  appId: "1:264407319824:web:477d2fae113f7cd81bd195"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let students = [];
let typingTimer;

// ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ø§Ø³Ù…
function normalize(text = "") {
  return text
    .toLowerCase()
    .replace(/[Ø£Ø¥Ø¢]/g, "Ø§")
    .replace(/Ù‰/g, "ÙŠ")
    .replace(/Ø©/g, "Ù‡")
    .replace(/\s+/g, "");
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
async function loadStudents() {
  const snap = await get(ref(db, "students"));
  if (!snap.exists()) return;

  const data = snap.val();
  for (let code in data) {
    const meta = data[code].meta;
    if (meta && meta["Ø§Ù„Ø§Ø³Ù…"]) {
      students.push({
        code,
        name: meta["Ø§Ù„Ø§Ø³Ù…"],
        grade: meta["Ø§Ù„ØµÙ"] || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"
      });
    }
  }
}
loadStudents();

// Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¯ÙˆÙ† ØªÙ‡Ù†ÙŠØ¬
document.getElementById("search").addEventListener("input", e => {
  clearTimeout(typingTimer);

  typingTimer = setTimeout(() => {
    const value = normalize(e.target.value);
    const results = document.getElementById("results");
    results.innerHTML = "";

    if (value.length < 3) return;

    const match = students.find(s =>
      normalize(s.name).includes(value)
    );

    if (match) {
      results.innerHTML = `
        <div class="card">
          <h2>${match.name}</h2>

          <div class="info">
            <span class="label">Ø§Ù„ØµÙ:</span> ${match.grade}
          </div>

          <div class="code">
            ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${match.code}
          </div>
        </div>
      `;
    } else {
      results.innerHTML = `
        <div class="notfound">
          âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù…
        </div>
      `;
    }
  }, 300);
});
</script>

</body>
</html>
